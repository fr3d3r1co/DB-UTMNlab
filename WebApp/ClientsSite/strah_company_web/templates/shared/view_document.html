{% extends "base.html" %}

{% block title %}–î–æ–∫—É–º–µ–Ω—Ç: {{ document.file_name }}{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="mb-0">–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –¥–æ–∫—É–º–µ–Ω—Ç–µ</h5>
                <a href="{{ url_for('documents_list') }}" class="btn btn-outline-dark btn-sm">
                    ‚Üê –ù–∞–∑–∞–¥ –∫ –¥–æ–∫—É–º–µ–Ω—Ç–∞–º
                </a>
            </div>
            <div class="card-body">
                {% if error %}
                <div class="alert alert-danger">
                    {{ error }}
                </div>
                {% endif %}
                
                {% if success %}
                <div class="alert alert-success">
                    {{ success }}
                </div>
                {% endif %}
                
                <div class="row">
                    <div class="col-md-6">
                        <table class="table table-sm">
                            <tr>
                                <th width="40%">–ù–∞–∑–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞:</th>
                                <td>{{ document.file_name }}</td>
                            </tr>
                            <tr>
                                <th>–û–ø–∏—Å–∞–Ω–∏–µ:</th>
                                <td>{{ document.description or '‚Äî' }}</td>
                            </tr>
                            <tr>
                                <th>–£—Ä–æ–≤–µ–Ω—å –¥–æ—Å—Ç—É–ø–∞:</th>
                                <td>
                                    <span class="badge 
                                        {% if document.confidentiality_level == 0 %}bg-success
                                        {% elif document.confidentiality_level == 1 %}bg-warning
                                        {% else %}bg-danger{% endif %}">
                                        {% if document.confidentiality_level == 0 %}–ü—É–±–ª–∏—á–Ω—ã–π
                                        {% elif document.confidentiality_level == 1 %}–î–°–ü
                                        {% else %}–¢–æ–ª—å–∫–æ –Ω–∞—á–∞–ª—å–Ω–∏–∫–∏{% endif %}
                                    </span>
                                </td>
                            </tr>
                            <tr>
                                <th>–†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞:</th>
                                <td>
                                    {% if document.file_size %}
                                        {{ "%.1f"|format(document.file_size / 1024 / 1024) }} –ú–ë
                                    {% else %}
                                        ‚Äî
                                    {% endif %}
                                </td>
                            </tr>
                        </table>
                    </div>
                    <div class="col-md-6">
                        <table class="table table-sm">
                            <tr>
                                <th width="40%">–û—Ç–¥–µ–ª:</th>
                                <td>{{ document.department_name }}</td>
                            </tr>
                            <tr>
                                <th>–°–æ–∑–¥–∞–ª:</th>
                                <td>{{ document.created_by_name }}</td>
                            </tr>
                            <tr>
                                <th>–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:</th>
                                <td>{{ document.created_at.strftime('%d.%m.%Y %H:%M') }}</td>
                            </tr>
                            {% if document.policy_id %}
                            <tr>
                                <th>–ü—Ä–∏–≤—è–∑–∞–Ω –∫ –ø–æ–ª–∏—Å—É:</th>
                                <td>‚Ññ {{ document.policy_id }}</td>
                            </tr>
                            {% endif %}
                        </table>
                    </div>
                </div>
                
                <!-- –û—Å–Ω–æ–≤–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è -->
                <div class="mt-4">
                    <a href="{{ url_for('download_document', document_id=document.document_id) }}" 
                       class="btn btn-primary">
                        üì• –°–∫–∞—á–∞—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç
                    </a>
                    
                    {% if user_role in ['department_manager', 'hr_manager', 'company_director', 'db_admin'] %}
                    <a href="{{ url_for('edit_document', document_id=document.document_id) }}" 
                       class="btn btn-outline-primary">
                        ‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
                    </a>
                    {% endif %}
                </div>
                
                <!-- –§–æ—Ä–º–∞ –∑–∞–º–µ–Ω—ã —Ñ–∞–π–ª–∞ - –¢–û–õ–¨–ö–û –î–õ–Ø –¢–ï–•, –ö–¢–û –ú–û–ñ–ï–¢ –†–ï–î–ê–ö–¢–ò–†–û–í–ê–¢–¨ -->
                {% if user_role in ['department_manager', 'hr_manager', 'company_director', 'db_admin'] %}
                <hr>
                <div class="mt-4">
                    <h6>üîÑ –ó–∞–º–µ–Ω–∞ —Ñ–∞–π–ª–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞</h6>
                    <p class="text-muted small mb-3">
                        –í—ã –º–æ–∂–µ—Ç–µ –∑–∞–º–µ–Ω–∏—Ç—å —Ç–µ–∫—É—â–∏–π —Ñ–∞–π–ª –Ω–æ–≤—ã–º. –°—Ç–∞—Ä—ã–π —Ñ–∞–π–ª –±—É–¥–µ—Ç —É–¥–∞–ª–µ–Ω.
                    </p>
                    
                    <form method="POST" action="{{ url_for('replace_document_file', document_id=document.document_id) }}" 
                          enctype="multipart/form-data" class="row g-3 align-items-end">
                        <div class="col-md-5">
                            <label class="form-label">–ù–æ–≤—ã–π —Ñ–∞–π–ª *</label>
                            <input type="file" class="form-control" name="document_file" 
                                   accept=".pdf,.doc,.docx,.xls,.xlsx,.jpg,.jpeg,.png,.txt" required>
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">–ù–æ–≤–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)</label>
                            <input type="text" class="form-control" name="file_name" 
                                   placeholder="{{ document.file_name }}" value="{{ document.file_name }}">
                        </div>
                        <div class="col-md-3">
                            <button type="submit" class="btn btn-warning w-100">–ó–∞–º–µ–Ω–∏—Ç—å —Ñ–∞–π–ª</button>
                        </div>
                    </form>
                </div>
                {% endif %}
                
                <!-- –£–¥–∞–ª–µ–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞ - –¢–û–õ–¨–ö–û –î–õ–Ø –¢–ï–•, –ö–¢–û –ú–û–ñ–ï–¢ –£–î–ê–õ–Ø–¢–¨ -->
                {% if user_role in ['department_manager', 'company_director', 'db_admin'] or document.created_by_employee_id == session.user_id %}
                <hr>
                <div class="mt-4">
                    <h6 class="text-danger">üóëÔ∏è –£–¥–∞–ª–µ–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞</h6>
                    <p class="text-muted small mb-3">
                        –í–Ω–∏–º–∞–Ω–∏–µ: —ç—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–æ–±—Ä–∞—Ç–∏–º–æ. –î–æ–∫—É–º–µ–Ω—Ç –∏ —Ñ–∞–π–ª –±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã –±–µ–∑ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è.
                    </p>
                    
                    <form method="POST" action="{{ url_for('delete_document', document_id=document.document_id) }}" 
                          onsubmit="return confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç ¬´{{ document.file_name }}¬ª?\\n\\n–≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–æ–±—Ä–∞—Ç–∏–º–æ!');">
                        <button type="submit" class="btn btn-danger">
                            üóëÔ∏è –£–¥–∞–ª–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç
                        </button>
                    </form>
                </div>
                {% endif %}
                
            </div>
        </div>
    </div>
</div>
{% endblock %}